<Window x:Class="PopupCash.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:prism="http://prismlibrary.com/"
        prism:ViewModelLocator.AutoWireViewModel="True"
        xmlns:behaviors="http://schemas.microsoft.com/xaml/behaviors"
        xmlns:tb="http://www.hardcodet.net/taskbar"
        xmlns:trayCommands="clr-namespace:PopupCash.Models.Commands.Impl"
        xmlns:viewmodels="clr-namespace:PopupCash.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        WindowStartupLocation="Manual"
        AllowsTransparency="True"
        Background="Transparent"
        BorderBrush="Transparent"
        BorderThickness="0"
        SizeToContent="Manual"        
        Padding="0"
        ResizeMode="NoResize"
        WindowStyle="None"
        Title="{Binding Title}"
        Width="374"
        Height="176"
        Left="{Binding WindowLeft, Mode=TwoWay}"
        Top="{Binding WindowTop, Mode=TwoWay}"
        x:Name="mainWindow"
        MinWidth="374"
        MinHeight="176">
    
    <Window.Triggers>
        <EventTrigger RoutedEvent="tb:TaskbarIcon.TrayToolTipOpen"
                      SourceName="trayIcon" />
    </Window.Triggers>


    <behaviors:Interaction.Triggers>
        <behaviors:EventTrigger EventName="Loaded">
            <prism:InvokeCommandAction Command="{Binding LoadedWindowCommand}"
                                       CommandParameter="{Binding ElementName=mainWindow}" />
        </behaviors:EventTrigger>
        <behaviors:EventTrigger EventName="Closed">
            <prism:InvokeCommandAction Command="{Binding ClosedWindowCommand}" CommandParameter="{Binding ElementName=mainWindow}"  />
        </behaviors:EventTrigger>
    </behaviors:Interaction.Triggers>


    <WindowChrome.WindowChrome>
        <WindowChrome CornerRadius="15"
                      CaptionHeight="0" />
    </WindowChrome.WindowChrome>

    <Border Style="{StaticResource windowBaseBorder}">
        <Grid>
            <ContentControl prism:RegionManager.RegionName="MainModuleContent" Focusable="False"
                            Padding="0" />
            <tb:TaskbarIcon x:Name="trayIcon"
                            Visibility="Visible"
                            ToolTipText="오테크"
                            IconSource="/Images/Icons/PopupCash.ico"
                            MenuActivation="RightClick"
                            DoubleClickCommand="{trayCommands:ShowWindowFromTrayIconCommand}"
                            DoubleClickCommandParameter="{Binding RelativeSource={RelativeSource Self}}">                
                <tb:TaskbarIcon.ContextMenu>
                    <ContextMenu  >
                        <MenuItem Header="오테크 보이기"
                                  Command="{trayCommands:ShowWindowFromTrayIconCommand}"
                                  CommandParameter="{x:Reference trayIcon}">
                            <MenuItem.Icon>
                                <Image Width="16"
                                       Height="16"
                                       Source="/Images/Icons/PopupCash.ico" />
                            </MenuItem.Icon>
                        </MenuItem>

                        <MenuItem Header="오테크 숨김"
                                  Command="{trayCommands:HideWindowFromTrayIconCommand}"
                                  CommandParameter="{x:Reference trayIcon}">
                            <MenuItem.Icon>
                                <Image Width="16"
                                       Height="16"
                                       Source="/Images/Icons/PopupCash.ico" />
                            </MenuItem.Icon>
                        </MenuItem>

                        <MenuItem Header="오테크 정보">
                            <MenuItem.Icon>
                                <Image Width="16"
                                       Height="16"
                                       Source="/Images/Icons/PopupCash.ico" />
                            </MenuItem.Icon>
                            <MenuItem Header="오픈소스 정보"
                                      Command="{trayCommands:OpenSourceInformationTrayIconCommand}"
                                      CommandParameter="{x:Reference trayIcon}">
                                <MenuItem.Icon>
                                    <Image Width="16"
                                           Height="16"
                                           Source="/Images/Icons/PopupCash.ico" />
                                </MenuItem.Icon>
                            </MenuItem>
                        </MenuItem>
                        
                        <MenuItem Header="오테크 종료"
                                  Command="{trayCommands:ExitProgramFromTrayIconCommand}"
                                  CommandParameter="{x:Reference trayIcon}">
                        <MenuItem.Icon>
                            <Image Width="16"
                                   Height="16"
                                   Source="/Images/Icons/PopupCash.ico" />
                        </MenuItem.Icon>
                        </MenuItem>
                    </ContextMenu>
                </tb:TaskbarIcon.ContextMenu>
            </tb:TaskbarIcon>
        </Grid>        
    </Border>

</Window>
